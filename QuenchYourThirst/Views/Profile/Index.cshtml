@model QuenchYourThirst.Areas.Admin.Models.AdminUser;

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

<!-- Icons. Uncomment required icon fonts -->
<link rel="stylesheet" href="~/admin/assets/vendor/fonts/boxicons.css" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

<!-- Core CSS -->
<link rel="stylesheet" href="~/admin/assets/vendor/css/core.css" class="template-customizer-core-css" />
<link rel="stylesheet" href="~/admin/assets/vendor/css/theme-default.css" class="template-customizer-theme-css" />
<link rel="stylesheet" href="~/admin/assets/css/demo.css" />
<link rel="stylesheet" href="~/css/validate.css" />
<link rel="stylesheet" href="~/css/bootstrap/bootstrap-grid.css" />
<link rel="stylesheet" href="~/css/bootstrap/bootstrap-reboot.css" />

<!-- Vendors CSS -->
<link rel="stylesheet" href="~/admin/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />

<link rel="stylesheet" href="~/admin/assets/vendor/libs/apex-charts/apex-charts.css" />

<!-- Page CSS -->
<!-- Helpers -->
<script src="~/admin/assets/vendor/js/helpers.js"></script>

<script src="~/js/validate.js"></script>

<!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
<!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
<script src="~/admin/assets/js/config.js"></script>
@* <style>
    .ftco-navbar-light.scrolled .nav-link {
        color: #fff !important;
    }

    .ftco-navbar-light.scrolled .nav-item.cta>a {
        background: none;
    }

    .btn-primary {
        color: #fff;
        background-color: #696cff !important;
        border-color: #696cff !important;
        box-shadow: 0 0.125rem 0.25rem 0 rgba(105, 108, 255, 0.4);
    }

    .btn.btn-primary:hover {
        color: #fff;
        background-color: #0069d9 !important;
        border-color: #0062cc !important;
    }
</style>
<style>
    .btn-primary,
    .bg-primary {
        color: #fff;
        background-color: #696cff !important;
        border-color: #696cff !important;
        box-shadow: 0 0.125rem 0.25rem 0 rgba(105, 108, 255, 0.4);
    }

    .btn.btn-primary:hover {
        color: #fff;
        background-color: #0069d9 !important;
        border-color: #0062cc !important;
    }

    .ftco-navbar-light .navbar-brand,
    .heading-section .subheading {
        color: #696cff !important;
    }

    .ftco-navbar-light.scrolled .nav-item.cta > a,
    .product .img-prod span.status {
        background-color: #696cff !important;
    }

    

    .ftco-navbar-light.scrolled .collapse.navbar-collapse > a {
        color: #000 !important;
    }
</style> *@
<style>
    body .ftco-navbar-light.scrolled {
        position: fixed;
        right: 0;
        left: 0;
        top: 0;
        margin-top: -130px;
        background: #fff !important;
        -webkit-box-shadow: 0 0 10px 0 rgba(0, 0, 0, 0.1);
        box-shadow: 0 0 10px 0 rgba(0, 0, 0, 0.1);
        padding: 0;
    }
</style>

<div class="content-wrapper">
    <!-- Content -->

    <div class="container-xxl flex-grow-1 container-p-y">
        <div class="row">
            <div class="col-md-12">
                <ul class="nav nav-pills flex-column flex-md-row mb-3">
                    <li class="nav-item">
                        <a class="nav-link active" href="javascript:void(0);"><i class="bx bx-user me-1"></i> Account</a>
                    </li>
                </ul>
                <div class="card mb-4">
                    <h5 class="card-header">Hồ sơ</h5>
                    <!-- Account -->
                    <div class="card-body">
                        <div class="d-flex align-items-start align-items-sm-center gap-4">
                            <img src="@Model.img_user" alt="user-avatar" class="d-block rounded" height="100" width="100" id="uploadedAvatar" />
                            <div class="button-wrapper">
                                <label for="upload" class="btn btn-primary me-2 mb-4" tabindex="0">
                                    <span class="d-none d-sm-block">Upload new photo</span>
                                    <i class="bx bx-upload d-block d-sm-none"></i>
                                    <input type="file" id="upload" class="account-file-input" hidden accept="image/png, image/jpeg" />
                                </label>
                                <button type="button" class="btn btn-outline-secondary account-image-reset mb-4">
                                    <i class="bx bx-reset d-block d-sm-none"></i>
                                    <span class="d-none d-sm-block">Reset</span>
                                </button>

                                <p class="text-muted mb-0">Allowed JPG, GIF or PNG. Max size of 800K</p>
                            </div>
                        </div>
                    </div>
                    <hr class="my-0" />
                    <div class="card-body">
                        <form asp-controller="Profile" asp-action="edit" method="POST" id="formAccountSettings">
                            <input type="hidden" asp-for="id" />
                            <input type="hidden" asp-for="password" />
                            <input type="hidden" asp-for="role_id" />

                            <div class="row">

                                <div class="mb-3 col-md-6">
                                    <label for="login_name" class="form-label">Tên đăng nhập</label>
                                    <input class="form-control" type="text" id="login_name" name="login_name" asp-for="login_name" readonly />
                                </div>
                                <div class="mb-3 col-md-6">
                                    <label for="email" class="form-label">Email *</label>
                                    <input class="form-control" type="text" id="email" name="email" asp-for="email" autofocus />
                                </div>
                                <div class="mb-3 col-md-6">
                                    <label for="address" class="form-label">Địa chỉ *</label>
                                    <input class="form-control" type="text" name="address" asp-for="address" id="address" />
                                </div>
                                <div class="mb-3 col-md-6">
                                    <label for="phone" class="form-label">Điện thoại *</label>
                                    <input class="form-control" type="text" id="phone" name="phone" asp-for="phone" placeholder="0987 654 321" />
                                </div>
                            </div>
                            <div class="mt-2">
                                <button type="submit" class="btn btn-primary me-2">Save changes</button>
                                <button type="reset" class="btn btn-outline-secondary">Cancel</button>
                            </div>
                        </form>
                    </div>
                    <!-- /Account -->
                    <h5 class="card-header">Thay đổi mật khẩu</h5>

                    <div class="card-body">
                        <form id="formPasswordSettings" method="POST" asp-controller="Profile" asp-action="EditPassword">
                            <div class="row">
                                <div class="mb-3 col-md-6">
                                    <label for="old-password" class="form-label">Mật khẩu cũ</label>
                                    <input class="form-control" type="password" id="old-password" name="old-password" placeholder="***********" />
                                    <p class="form-message"></p>
                                </div>
                                <div class="mb-3 col-md-6">
                                    <label for="password" class="form-label">Mật khẩu mới</label>
                                    <input class="form-control" type="password" id="password" name="password" placeholder="***********" />
                                    <p class="form-message"></p>
                                </div>
                                <div class="mb-3 col-md-6">
                                    <label for="confirm-password" class="form-label">Xác nhận mật khẩu mới</label>
                                    <input class="form-control" type="password" id="confirm-password" name="confirm-password" placeholder="***********" />
                                    <p class="form-message"></p>
                                </div>
                            </div>
                            <div class="mt-2">
                                <button type="submit" class="btn btn-primary me-2">Save changes</button>
                                <button type="reset" class="btn btn-outline-secondary">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
                @* <div class="card">
                    <h5 class="card-header">Delete Account</h5>
                    <div class="card-body">
                        <div class="mb-3 col-12 mb-0">
                            <div class="alert alert-warning">
                                <h6 class="alert-heading fw-bold mb-1">Are you sure you want to delete your account?</h6>
                                <p class="mb-0">Once you delete your account, there is no going back. Please be certain.</p>
                            </div>
                        </div>
                        <form id="formAccountDeactivation" onsubmit="return false">
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" name="accountActivation" id="accountActivation" />
                                <label class="form-check-label" for="accountActivation">I confirm my account deactivation</label>
                            </div>
                            <button type="submit" class="btn btn-danger deactivate-account">Deactivate Account</button>
                        </form>
                    </div>
                </div> *@
            </div>
        </div>
    </div>
    <!-- / Content -->
</div>
<!-- build:js assets/vendor/js/core.js -->
<script src="~/admin/assets/vendor/libs/jquery/jquery.js"></script>
<script src="~/admin/assets/vendor/libs/popper/popper.js"></script>
<script src="~/admin/assets/vendor/js/bootstrap.js"></script>
<script src="~/admin/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>

<script src="../assets/vendor/js/menu.js"></script>

<script src="~/admin/assets/vendor/js/menu.js"></script>
<!-- endbuild -->
<!-- Vendors JS -->
<!-- Main JS -->
<script src="~/admin/assets/js/main.js"></script>

<!-- Page JS -->
<script src="~/admin/assets/js/pages-account-settings-account.js"></script>

<!-- Place this tag in your head or just before your close body tag. -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.0/axios.min.js" integrity="sha512-WrdC3CE9vf1nBf58JHepuWT4x24uTacky9fuzw2g/3L9JkihgwZ6Cfv+JGTtNyosOhEmttMtEZ6H3qJWfI7gIQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script async defer src="https://buttons.github.io/buttons.js"></script>

<script>
    function formProfile(options) {
        const form = document.querySelector(options.form)
        form.addEventListener('submit', function (e) {
            e.preventDefault()
            const imgUserInput = document.createElement('input');
            imgUserInput.type = 'hidden';
            imgUserInput.name = 'img_user';
            imgUserInput.value = document.querySelector('#uploadedAvatar').src;
            form.appendChild(imgUserInput);
            const newData = {}
            $(options.form).serializeArray().forEach(function (value) {
                newData[value.name] = value.value
            })
            console.log(newData)
            this.submit()
            // axios.post()
        })

    }
    formProfile({
        form: '#formAccountSettings',
    })

    handleImport({
        form: '#formPasswordSettings',
        formInput: '.form-control',
        formMessage: '.form-message',
        rules: [
            handleImport.isFocus('#old-password', 'Vui lòng nhập mật khẩu cũ'),
            handleImport.isFocus('#password', 'Vui lòng nhập mật khẩu mới'),
            handleImport.isFocus('#confirm-password', 'Vui lòng nhập lại mật khẩu mới'),
            handleImport.isPassword('#password', 'Vui lòng nhập lại mật khẩu mới'),
            handleImport.isConfirmPassword('#confirm-password', 'Vui lòng nhập lại mật khẩu mới', '#formPasswordSettings #password'),
        ],
        isSuccess: function (data, form) {
            const newData = {}
            $("#formPasswordSettings").serializeArray().forEach(function (value) {
                newData[value.name] = value.value
            })
            const cart = document.getElementById('alert')
            const newElement = document.createElement("div")
            const newButton = document.createElement("button")

            newElement.classList.add("alert", 'alert-dismissible');
            newElement.setAttribute("role", "alert")
            newElement.style.animation = "scrollTop .60s linear"

            newButton.classList.add("btn-close")
            newButton.setAttribute("data-bs-dismiss", "alert")
            newButton.setAttribute("aria-label", "Close")

            axios.post(window.location.href + '/editpassword', newData)
                .then(response => response.data)
                .then(data => {
                    addElement(data.message, newElement, cart, "alert-success", newButton)

                })
                .catch(err => {
                    addElement(err.response.data.message, newElement, cart, "alert-danger", newButton)
                    var errElement = form.querySelector(err.response.data.err)
                    errElement.nextElementSibling.innerText = err.response.data.message
                })
        }
    })
</script>
<script>
    function addElement(message, newElement, parent, _Class, newButton) {
        newElement.classList.add(_Class);
        newElement.innerText = message
        newElement.appendChild(newButton)

        parent.firstElementChild.appendChild(newElement)

        setTimeout(() => {
            newElement.style.animation = "scrollTopRemove .60s linear"
            setTimeout(() => {
                parent.firstElementChild.removeChild(newElement)
            }, 600);
        }, 3000);
    }
</script>